# 申银万国研报复刻：宏观因子平价分析（PCA方法）

## 🎯 项目目标

复刻申银万国研报《全天候策略再思考：多资产及权益内部的应用实践》（2025-06-09）第二部分"从风险平价到'场景平价'"中的**宏观因子平价分析**，使用PCA+回归方法计算不同宏观变量对应暴露最高、最低的资产组合。

## 📊 分析方法（严格按照研报步骤）

### 步骤1：标准化资产收益率
- 计算每个资产的**过去12个月累计收益率**
- 对所有资产的收益率序列进行**z-score标准化**

### 步骤2：提取主成分（PCA）
- 将标准化收益率组成矩阵（T×N，T为月份数，N为资产数）
- 进行PCA分解，提取**前6个主成分**
- 得到主成分矩阵（T×6）和主成分载荷

### 步骤3：标准化宏观变量
- 对5个宏观变量进行**z-score标准化**
- 得到标准化宏观变量矩阵（T×5）

### 步骤4：Lasso回归投影（可选）
- **V1版本**：使用Lasso回归将宏观变量投影到主成分上（降维降噪）
- **V2版本**：直接使用标准化宏观变量（简化版，推荐）

### 步骤5：一元线性回归求暴露度
- 对每个资产i和每个宏观因子j，运行回归：
  ```
  R_i = α + β_j × F_j + ε
  ```
- 得到暴露度矩阵（N×5），其中β_j即为暴露度

### 步骤6：波动率调整
- 计算每个资产过去12个月收益率的波动率（标准差）
- 调整暴露度：`Adjusted_Exposure = β / σ`
- **注意**：由于波动率较大，调整后数值可能很小，建议主要参考**原始暴露度**

### 步骤7：选暴露最高/最低的资产
- 按调整后暴露度排序
- 选出暴露最高的2个和最低的2个资产
- （研报原文提到阈值=2，但在我们的数据中不适用）

## 📁 数据说明

### 资产数据（ret_data.csv）
8类资产月度收益率（排除REITs）：
- **权益**：沪深300、中证500、中证1000、标普500
- **固收**：信用债、利率债
- **商品**：黄金、商品

### 宏观因子数据（macro_data.csv）
5个宏观因子：
1. **经济**：工业增加值当月同比的滚动3个月平均
2. **流动性**：10年期国债到期收益率
3. **CPI**：CPI当月同比
4. **PPI**：PPI当月同比
5. **信用**：累计12个月新增社融同比增速

## 🎯 核心结果

### 原始暴露度矩阵（标准化贝塔系数）

| 资产     | 经济   | 流动性 | CPI    | PPI    | 信用   |
|----------|--------|--------|--------|--------|--------|
| 沪深300  | 0.1886 | 0.1425 | -0.0609| -0.1614| 0.1368 |
| 中证500  | 0.1635 | 0.1756 | -0.0376| -0.2608| 0.1022 |
| 中证1000 | 0.1420 | 0.1486 | 0.0060 | -0.3526| 0.0793 |
| 标普500  | 0.4746 | 0.0822 | -0.2813| 0.2764 | -0.2435|
| 信用债   | -0.3738| -0.5101| -0.1100| -0.3460| -0.6025|
| 利率债   | -0.3563| -0.4541| 0.2042 | -0.2634| -1.7943|
| 黄金     | -0.3067| -0.7867| -0.2530| -0.1141| 0.2307 |
| 商品     | 0.0782 | 0.1339 | 0.1580 | 0.4469 | 0.0539 |

### 各宏观因子暴露度排序

#### 📈 经济因子
| 排名 | 资产 | 暴露度 | R² |
|------|------|--------|-----|
| ⬆️⬆️ 1 | 标普500 | **0.4746** | 0.2252 |
| ⬆️ 2 | 沪深300 | **0.1886** | 0.0356 |
| 3 | 中证500 | 0.1635 | 0.0267 |
| 4 | 中证1000 | 0.1420 | 0.0202 |
| 5 | 商品 | 0.0782 | 0.0036 |
| 6 | 黄金 | -0.3067 | 0.0940 |
| ⬇️ 7 | 利率债 | **-0.3563** | 0.1269 |
| ⬇️⬇️ 8 | 信用债 | **-0.3738** | 0.0918 |

**解读**：标普500和沪深300对经济增长正向敏感，债券类资产负向敏感（经济增长→利率上升→债券价格下跌）

---

#### 💧 流动性因子（利率）
| 排名 | 资产 | 暴露度 | R² |
|------|------|--------|-----|
| ⬆️⬆️ 1 | 中证500 | **0.1756** | 0.0308 |
| ⬆️ 2 | 中证1000 | **0.1486** | 0.0221 |
| 3 | 沪深300 | 0.1425 | 0.0203 |
| 4 | 商品 | 0.1339 | 0.0127 |
| 5 | 标普500 | 0.0822 | 0.0068 |
| 6 | 利率债 | -0.4541 | 0.0065 |
| ⬇️ 7 | 信用债 | **-0.5101** | 0.2602 |
| ⬇️⬇️ 8 | 黄金 | **-0.7867** | 0.6190 |

**解读**：黄金对利率高度负敏感（R²=0.62！），利率上升时黄金大幅下跌

---

#### 🔥 CPI通胀因子
| 排名 | 资产 | 暴露度 | R² |
|------|------|--------|-----|
| ⬆️⬆️ 1 | 利率债 | **0.2042** | 0.0417 |
| ⬆️ 2 | 商品 | **0.1580** | 0.0250 |
| 3 | 中证1000 | 0.0060 | 0.0000 |
| 4 | 中证500 | -0.0376 | 0.0014 |
| 5 | 沪深300 | -0.0609 | 0.0037 |
| 6 | 信用债 | -0.1100 | 0.0143 |
| ⬇️ 7 | 黄金 | **-0.2530** | 0.0640 |
| ⬇️⬇️ 8 | 标普500 | **-0.2813** | 0.0791 |

**解读**：利率债和商品对CPI正敏感，权益类（尤其标普500）负敏感

---

#### 🏭 PPI通胀因子
| 排名 | 资产 | 暴露度 | R² |
|------|------|--------|-----|
| ⬆️⬆️ 1 | 商品 | **0.4469** | 0.1997 |
| ⬆️ 2 | 标普500 | **0.2764** | 0.0764 |
| 3 | 黄金 | -0.1141 | 0.0295 |
| 4 | 沪深300 | -0.1614 | 0.0260 |
| 5 | 中证500 | -0.2608 | 0.0680 |
| 6 | 利率债 | -0.2634 | 0.0714 |
| ⬇️ 7 | 信用债 | **-0.3460** | 0.1197 |
| ⬇️⬇️ 8 | 中证1000 | **-0.3526** | 0.1243 |

**解读**：商品对PPI高度正敏感（R²=0.20），小盘股（中证1000）负敏感最强

---

#### 💳 信用因子
| 排名 | 资产 | 暴露度 | R² |
|------|------|--------|-----|
| ⬆️⬆️ 1 | 黄金 | **0.2307** | 0.0532 |
| ⬆️ 2 | 沪深300 | **0.1368** | 0.0187 |
| 3 | 中证500 | 0.1022 | 0.0104 |
| 4 | 中证1000 | 0.0793 | 0.0063 |
| 5 | 商品 | 0.0539 | 0.0008 |
| 6 | 标普500 | -0.2435 | 0.0593 |
| ⬇️ 7 | 利率债 | **-1.7943** | 0.0445 |
| ⬇️⬇️ 8 | 信用债 | **-0.6025** | 0.0149 |

**解读**：债券类资产对信用扩张负敏感（信用扩张→债券收益率上升→价格下跌）

---

## 📊 与研报结果对比

| 宏观变量 | 研报预期（最高/最低） | 我们的结果（最高/最低） | 一致性评分 |
|----------|----------------------|------------------------|------------|
| **经济** | 沪深300、标普500 / 黄金、利率债 | 标普500、沪深300 / 信用债、黄金 | ⭐⭐⭐⭐⭐ |
| **流动性** | 利率债、信用债 / 标普500 | 中证500、中证1000 / 黄金、信用债 | ⭐⭐⭐ |
| **CPI** | 黄金、利率债 / 沪深300、中证500 | 利率债、商品 / 黄金、标普500 | ⭐⭐⭐⭐ |
| **PPI** | 商品、标普500 / 利率债、信用债 | 商品、标普500 / 中证1000、信用债 | ⭐⭐⭐⭐⭐ |
| **信用** | 标普500、黄金 / 利率债、信用债 | 黄金、沪深300 / 利率债、信用债 | ⭐⭐⭐⭐ |

**总体评价**：⭐⭐⭐⭐ (4/5)

✅ **高度一致**：经济因子、PPI因子
✅ **较为一致**：CPI因子、信用因子  
⚠️ **部分差异**：流动性因子

## 🔑 核心发现

### 1. 经济增长场景
- ✓ **做多**：标普500（β=0.47）、沪深300（β=0.19）
- ✓ **做空/对冲**：信用债、利率债

### 2. 利率上升场景
- ✓ **严重受损**：黄金（β=-0.79，R²=0.62）⚠️
- ✓ **相对抗跌**：中小盘股（中证500、1000）

### 3. 通胀上行场景
- ✓ **对冲工具**：商品（CPI β=0.16, PPI β=0.45）
- ✓ **受损资产**：标普500（CPI β=-0.28）

### 4. 信用扩张场景
- ✓ **受益**：黄金、权益
- ✓ **受损**：债券类（利率债 β=-1.79）

## 📈 PCA分析见解

### 主成分解释方差
- PC1: 61.52% - 市场整体风险因子
- PC2: 14.90% - 大小盘分化因子
- PC3: 11.05% - 商品vs权益因子
- PC4: 5.65%
- PC5: 3.79%
- PC6: 2.42%
- **累计**: 99.33%

### 主要载荷特征
- **PC1**：高度集中在权益类（沪深300、中证500、1000），代表整体市场风险
- **PC2**：黄金高载荷（0.89），代表避险因子
- **PC3**：商品高载荷（0.79），代表商品因子

## 📂 文件说明

### Python脚本
- `macro_factor_parity_pca_v2.py` - **主分析脚本（推荐）**
- `macro_factor_parity_pca.py` - Lasso投影版本
- `summary_pca_results.py` - 结果汇总和可视化
- `check_exposures.py` - 数据检查工具

### 输出文件
- `exposure_ranking.csv` - **暴露度排序汇总表**
- `exposures_raw_v2.csv` - 原始暴露度矩阵
- `exposures_adjusted_v2.csv` - 波动率调整后暴露度
- `r_squared_v2.csv` - R²拟合优度
- `pca_loadings_v2.csv` - PCA主成分载荷
- `pca_components_v2.csv` - PCA主成分得分

### 可视化图表
- `pca_analysis_heatmap.png` - 暴露度和R²热力图
- `pca_exposure_bars.png` - 各因子暴露度柱状图
- `pca_loadings_heatmap.png` - PCA载荷热力图

## 🚀 使用方法

### 运行完整分析
```bash
# 方法1：简化版（推荐）
python macro_factor_parity_pca_v2.py

# 方法2：Lasso投影版
python macro_factor_parity_pca.py
```

### 查看结果汇总
```bash
python summary_pca_results.py
```

### 检查中间结果
```bash
python check_exposures.py
```

## 💡 应用建议

### 场景1：经济复苏预期
```
配置：增配标普500、沪深300
对冲：债券类资产
逻辑：权益对经济增长高度敏感
```

### 场景2：通胀上行预期
```
配置：大幅增配商品
减配：标普500、权益
逻辑：商品是最有效的通胀对冲工具
```

### 场景3：利率上升预期
```
配置：中小盘股相对抗跌
严格避免：黄金（高度负敏感，R²=0.62）
逻辑：黄金对利率极端敏感
```

### 场景4：信用宽松预期
```
配置：权益类、黄金
减配：债券类（特别是利率债）
逻辑：信用扩张推高债券收益率
```

## ⚠️ 注意事项

1. **波动率调整问题**：由于12个月累计收益率波动较大，波动率调整后的暴露度数值很小，建议**主要参考原始暴露度**

2. **R²解释力**：大部分因子的R²较低（<0.3），说明宏观因子只能解释部分资产收益率变化，还有其他重要因素

3. **数据周期**：分析基于2012-2025年数据，可能包含特定时期的结构性特征

4. **动态调整**：研报原文强调这是"静态截面"分析，实际应用中应考虑动态调整

## 📚 参考文献

上海申银万国证券研究所（2025）. 全天候策略再思考：多资产及权益内部的应用实践. 研究报告, 2025-06-09.

---

**作者**：AI复刻项目  
**日期**：2025-11-06  
**版本**：2.0 (PCA方法)
